{% extends "layout.html" %}

{% block title %}ğŸ› ï¸ Chensyå·¥å…·ç®± - {{ t('Prompt ç®¡ç†å™¨') }}{% endblock %}

{% block content %}
<style>
    .header {
        background: white;
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 15px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        text-align: center;
    }
    
    .header h1 {
        color: #333;
        font-size: 2em;
        margin-bottom: 8px;
    }
    
    .header p {
        color: #666;
        font-size: 1.1em;
    }
    
    .tools-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }
    
    .tool-card {
        background: white;
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid transparent;
    }
    
    .tool-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        border-color: #667eea;
    }
    
    .tool-card.active {
        border-color: #667eea;
        background: #f8f9ff;
    }
    
    .tool-icon {
        font-size: 2em;
        margin-bottom: 8px;
    }
    
    .tool-card h3 {
        color: #333;
        margin-bottom: 5px;
        font-size: 1.1em;
    }
    
    .tool-card p {
        color: #666;
        font-size: 0.8em;
        line-height: 1.4;
    }
    
    .workspace {
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        display: none;
    }
    
    .workspace.active {
        display: block;
    }
    
    .workspace-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f0f0f0;
    }
    
    .workspace-header h2 {
        color: #333;
        font-size: 1.8em;
    }
    
    .btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1em;
        transition: all 0.3s ease;
        margin-right: 10px;
    }
    
    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
    
    .btn-secondary {
        background: #6c757d;
    }
    
    .btn-success {
        background: #28a745;
    }
    
    .btn-danger {
        background: #dc3545;
    }
    
    textarea {
        width: 100%;
        min-height: 300px;
        padding: 15px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-family: 'Courier New', monospace;
        font-size: 14px;
        resize: vertical;
        transition: border-color 0.3s ease;
    }
    
    textarea:focus {
        outline: none;
        border-color: #667eea;
    }
    
    .input-group {
        margin-bottom: 20px;
    }
    
    .input-group label {
        display: block;
        color: #333;
        font-weight: 600;
        margin-bottom: 8px;
    }
    
    .input-group input,
    .input-group select {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 14px;
        transition: border-color 0.3s ease;
    }
    
    .input-group input:focus,
    .input-group select:focus {
        outline: none;
        border-color: #667eea;
    }
    
    .two-column {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }
    
    .result-box {
        background: #f8f9fa;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        padding: 15px;
        margin-top: 20px;
        font-family: 'Courier New', monospace;
        word-break: break-all;
    }
    
    .alert {
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
    }
    
    .alert-success {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
    }
    
    .alert-error {
        background: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
    }
    
    .cron-preview {
        background: #e7f3ff;
        border-left: 4px solid #2196F3;
        padding: 15px;
        margin-top: 15px;
        border-radius: 4px;
    }
    
    .cron-preview h4 {
        color: #1976D2;
        margin-bottom: 10px;
    }
    
    .next-runs {
        list-style: none;
        padding: 0;
    }
    
    .next-runs li {
        padding: 5px 0;
        color: #555;
    }
    
    @media (max-width: 768px) {
        .two-column {
            grid-template-columns: 1fr;
        }
        
        .header h1 {
            font-size: 1.8em;
        }
    }
    
    /* ä¿®å¤é¡¶éƒ¨å¯¼èˆªé“¾æ¥é¢œè‰²é—®é¢˜ */
    header.topbar .nav a {
        color: var(--fg);
    }
</style>

<div class="container">
    <!-- Header -->
    <div class="header">
        <h1>ğŸ› ï¸ å¸¸ç”¨å·¥å…·ç®±</h1>
        <p>å¸¸ç”¨å¼€å‘å·¥å…·é›†åˆ - ç®€å•ã€å¿«é€Ÿã€å®ç”¨</p>
    </div>
    
    <!-- Tool Selection Grid -->
    <div class="tools-grid">
        <div class="tool-card" onclick="showTool('json')">
            <div class="tool-icon">ğŸ“</div>
            <h3>JSON å·¥å…·</h3>
            <p>æ ¼å¼åŒ–ã€å‹ç¼©ã€éªŒè¯JSONæ•°æ®</p>
        </div>
        
        <div class="tool-card" onclick="showTool('cron')">
            <div class="tool-icon">â°</div>
            <h3>Cron è¡¨è¾¾å¼</h3>
            <p>å¯è§†åŒ–ç”Ÿæˆå’Œè§£æCronè¡¨è¾¾å¼</p>
        </div>
        
        <div class="tool-card" onclick="showTool('base64')">
            <div class="tool-icon">ğŸ”</div>
            <h3>Base64 ç¼–è§£ç </h3>
            <p>Base64 ç¼–ç å’Œè§£ç å·¥å…·</p>
        </div>
        
        <div class="tool-card" onclick="showTool('timestamp')">
            <div class="tool-icon">ğŸ•</div>
            <h3>æ—¶é—´æˆ³è½¬æ¢</h3>
            <p>æ—¶é—´æˆ³ä¸æ—¥æœŸæ ¼å¼äº’è½¬</p>
        </div>
        
        <div class="tool-card" onclick="showTool('url')">
            <div class="tool-icon">ğŸ”—</div>
            <h3>URL ç¼–è§£ç </h3>
            <p>URL ç¼–ç å’Œè§£ç å·¥å…·</p>
        </div>
        
        <div class="tool-card" onclick="showTool('hash')">
            <div class="tool-icon">ğŸ”’</div>
            <h3>å“ˆå¸Œè®¡ç®—</h3>
            <p>MD5ã€SHA1ã€SHA256 è®¡ç®—</p>
        </div>
        
        <div class="tool-card" onclick="showTool('uuid')">
            <div class="tool-icon">ğŸ²</div>
            <h3>UUID ç”Ÿæˆå™¨</h3>
            <p>ç”Ÿæˆå„ç§ç‰ˆæœ¬çš„UUID</p>
        </div>
        
        <div class="tool-card" onclick="showTool('color')">
            <div class="tool-icon">ğŸ¨</div>
            <h3>é¢œè‰²è½¬æ¢</h3>
            <p>HEXã€RGBã€HSL é¢œè‰²è½¬æ¢</p>
        </div>
        
        <div class="tool-card" onclick="showTool('jasypt')">
            <div class="tool-icon">ğŸ”’</div>
            <h3>Jasypt åŠ è§£å¯†</h3>
            <p>é…ç½®æ–‡ä»¶åŠ è§£å¯†å·¥å…·</p>
        </div>
    </div>
    
    <!-- JSON Tool -->
    <div id="json-workspace" class="workspace">
        <div class="workspace-header">
            <h2>ğŸ“ JSON å·¥å…·</h2>
            <div>
                <button class="btn" onclick="formatJSON()">æ ¼å¼åŒ–</button>
                <button class="btn btn-secondary" onclick="compressJSON()">å‹ç¼©</button>
                <button class="btn btn-success" onclick="validateJSON()">éªŒè¯</button>
                <button class="btn btn-danger" onclick="clearJSON()">æ¸…ç©º</button>
            </div>
        </div>
        <div id="json-alert"></div>
        <textarea id="json-input" placeholder="åœ¨æ­¤è¾“å…¥æˆ–ç²˜è´´JSONæ•°æ®..."></textarea>
    </div>
    
    <!-- Cron Tool -->
    <div id="cron-workspace" class="workspace">
        <div class="workspace-header">
            <h2>â° Cron è¡¨è¾¾å¼ç”Ÿæˆå™¨</h2>
        </div>
        
        <div class="input-group">
            <label>é€‰æ‹©é¢„è®¾æ¨¡æ¿ï¼š</label>
            <select id="cron-preset" onchange="applyCronPreset()">
                <option value="">-- é€‰æ‹©é¢„è®¾ --</option>
                <option value="* * * * *">æ¯åˆ†é’Ÿ</option>
                <option value="0 * * * *">æ¯å°æ—¶</option>
                <option value="0 0 * * *">æ¯å¤©å‡Œæ™¨</option>
                <option value="0 0 * * 0">æ¯å‘¨æ—¥å‡Œæ™¨</option>
                <option value="0 0 1 * *">æ¯æœˆ1å·å‡Œæ™¨</option>
                <option value="0 9 * * 1-5">å·¥ä½œæ—¥ä¸Šåˆ9ç‚¹</option>
                <option value="*/5 * * * *">æ¯5åˆ†é’Ÿ</option>
                <option value="0 */2 * * *">æ¯2å°æ—¶</option>
            </select>
        </div>
        
        <div class="two-column">
            <div class="input-group">
                <label>åˆ†é’Ÿ (0-59):</label>
                <input type="text" id="cron-minute" value="*" placeholder="* æˆ– 0-59">
            </div>
            <div class="input-group">
                <label>å°æ—¶ (0-23):</label>
                <input type="text" id="cron-hour" value="*" placeholder="* æˆ– 0-23">
            </div>
        </div>
        
        <div class="two-column">
            <div class="input-group">
                <label>æ—¥æœŸ (1-31):</label>
                <input type="text" id="cron-day" value="*" placeholder="* æˆ– 1-31">
            </div>
            <div class="input-group">
                <label>æœˆä»½ (1-12):</label>
                <input type="text" id="cron-month" value="*" placeholder="* æˆ– 1-12">
            </div>
        </div>
        
        <div class="input-group">
            <label>æ˜ŸæœŸ (0-6, 0=å‘¨æ—¥):</label>
            <input type="text" id="cron-week" value="*" placeholder="* æˆ– 0-6">
        </div>
        
        <button class="btn" onclick="generateCron()">ç”Ÿæˆè¡¨è¾¾å¼</button>
        
        <div class="cron-preview" id="cron-result" style="display: none;">
            <h4>Cron è¡¨è¾¾å¼ï¼š</h4>
            <div class="result-box" id="cron-expression"></div>
            <h4 style="margin-top: 15px;">è¯´æ˜ï¼š</h4>
            <p id="cron-description"></p>
            <h4 style="margin-top: 15px;">æ¥ä¸‹æ¥5æ¬¡æ‰§è¡Œæ—¶é—´ï¼š</h4>
            <ul class="next-runs" id="next-runs"></ul>
        </div>
    </div>
    
    <!-- Base64 Tool -->
    <div id="base64-workspace" class="workspace">
        <div class="workspace-header">
            <h2>ğŸ” Base64 ç¼–è§£ç </h2>
            <div>
                <button class="btn" onclick="encodeBase64()">ç¼–ç </button>
                <button class="btn btn-secondary" onclick="decodeBase64()">è§£ç </button>
                <button class="btn btn-danger" onclick="clearBase64()">æ¸…ç©º</button>
            </div>
        </div>
        <div id="base64-alert"></div>
        <div class="input-group">
            <label>è¾“å…¥æ–‡æœ¬ï¼š</label>
            <textarea id="base64-input" placeholder="è¾“å…¥è¦ç¼–ç æˆ–è§£ç çš„æ–‡æœ¬..."></textarea>
        </div>
        <div class="input-group">
            <label>è¾“å‡ºç»“æœï¼š</label>
            <textarea id="base64-output" readonly placeholder="ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>
        </div>
    </div>
    
    <!-- Timestamp Tool -->
    <div id="timestamp-workspace" class="workspace">
        <div class="workspace-header">
            <h2>ğŸ• æ—¶é—´æˆ³è½¬æ¢</h2>
        </div>
        
        <div class="input-group">
            <label>å½“å‰æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ï¼š</label>
            <div class="result-box" id="current-timestamp"></div>
        </div>
        
        <div class="two-column">
            <div>
                <div class="input-group">
                    <label>æ—¶é—´æˆ³è½¬æ—¥æœŸï¼š</label>
                    <input type="text" id="ts-to-date-input" placeholder="è¾“å…¥æ—¶é—´æˆ³ï¼ˆç§’æˆ–æ¯«ç§’ï¼‰">
                    <button class="btn" onclick="timestampToDate()" style="margin-top: 10px; width: 100%;">è½¬æ¢</button>
                </div>
                <div class="result-box" id="ts-to-date-result"></div>
            </div>
            
            <div>
                <div class="input-group">
                    <label>æ—¥æœŸè½¬æ—¶é—´æˆ³ï¼š</label>
                    <input type="datetime-local" id="date-to-ts-input">
                    <button class="btn" onclick="dateToTimestamp()" style="margin-top: 10px; width: 100%;">è½¬æ¢</button>
                </div>
                <div class="result-box" id="date-to-ts-result"></div>
            </div>
        </div>
    </div>
    
    <!-- URL Tool -->
    <div id="url-workspace" class="workspace">
        <div class="workspace-header">
            <h2>ğŸ”— URL ç¼–è§£ç </h2>
            <div>
                <button class="btn" onclick="encodeURL()">ç¼–ç </button>
                <button class="btn btn-secondary" onclick="decodeURL()">è§£ç </button>
                <button class="btn btn-danger" onclick="clearURL()">æ¸…ç©º</button>
            </div>
        </div>
        <div id="url-alert"></div>
        <div class="input-group">
            <label>è¾“å…¥ URLï¼š</label>
            <textarea id="url-input" placeholder="è¾“å…¥è¦ç¼–ç æˆ–è§£ç çš„URL..."></textarea>
        </div>
        <div class="input-group">
            <label>è¾“å‡ºç»“æœï¼š</label>
            <textarea id="url-output" readonly placeholder="ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>
        </div>
    </div>
    
    <!-- Hash Tool -->
    <div id="hash-workspace" class="workspace">
        <div class="workspace-header">
            <h2>ğŸ”’ å“ˆå¸Œè®¡ç®—</h2>
            <div>
                <button class="btn" onclick="calculateHash()">è®¡ç®—</button>
                <button class="btn btn-danger" onclick="clearHash()">æ¸…ç©º</button>
            </div>
        </div>
        <div class="input-group">
            <label>è¾“å…¥æ–‡æœ¬ï¼š</label>
            <textarea id="hash-input" placeholder="è¾“å…¥è¦è®¡ç®—å“ˆå¸Œçš„æ–‡æœ¬..."></textarea>
        </div>
        <div class="input-group">
            <label>MD5ï¼š</label>
            <div class="result-box" id="hash-md5"></div>
        </div>
        <div class="input-group">
            <label>SHA-1ï¼š</label>
            <div class="result-box" id="hash-sha1"></div>
        </div>
        <div class="input-group">
            <label>SHA-256ï¼š</label>
            <div class="result-box" id="hash-sha256"></div>
        </div>
    </div>
    
    <!-- UUID Tool -->
    <div id="uuid-workspace" class="workspace">
        <div class="workspace-header">
            <h2>ğŸ² UUID ç”Ÿæˆå™¨</h2>
            <div>
                <button class="btn" onclick="generateUUID()">ç”Ÿæˆ UUID v4</button>
                <button class="btn btn-secondary" onclick="generateMultipleUUID()">æ‰¹é‡ç”Ÿæˆ</button>
            </div>
        </div>
        <div class="input-group">
            <label>ç”Ÿæˆæ•°é‡ï¼ˆæ‰¹é‡ç”Ÿæˆï¼‰ï¼š</label>
            <input type="number" id="uuid-count" value="10" min="1" max="100">
        </div>
        <div class="input-group">
            <label>ç”Ÿæˆçš„ UUIDï¼š</label>
            <textarea id="uuid-output" readonly placeholder="ç‚¹å‡»æŒ‰é’®ç”ŸæˆUUID..."></textarea>
        </div>
    </div>
    
    <!-- Color Tool -->
    <div id="color-workspace" class="workspace">
        <div class="workspace-header">
            <h2>ğŸ¨ é¢œè‰²è½¬æ¢</h2>
        </div>
        
        <div class="two-column">
            <div class="input-group">
                <label>é€‰æ‹©é¢œè‰²ï¼š</label>
                <input type="color" id="color-picker" value="#667eea" onchange="updateColorValues()">
            </div>
            <div style="background: var(--color, #667eea); border-radius: 8px; min-height: 100px;" id="color-preview"></div>
        </div>
        
        <div class="input-group">
            <label>HEXï¼š</label>
            <input type="text" id="color-hex" value="#667eea" oninput="convertFromHex()">
        </div>
        
        <div class="input-group">
            <label>RGBï¼š</label>
            <input type="text" id="color-rgb" placeholder="rgb(102, 126, 234)" oninput="convertFromRGB()">
        </div>
        
        <div class="input-group">
            <label>HSLï¼š</label>
            <input type="text" id="color-hsl" placeholder="hsl(231, 77%, 66%)" readonly>
        </div>
    </div>
    
    <!-- Jasypt Encryption Tool -->
    <div id="jasypt-workspace" class="workspace">
        <div class="workspace-header">
            <h2>ğŸ”’ Jasypt åŠ è§£å¯†å·¥å…·</h2>
            <div>
                <button class="btn" onclick="encryptText()">åŠ å¯†</button>
                <button class="btn btn-secondary" onclick="decryptText()">è§£å¯†</button>
                <button class="btn btn-danger" onclick="clearJasypt()">æ¸…ç©º</button>
            </div>
        </div>
        <div id="jasypt-alert"></div>
        <div class="input-group">
            <label>å¯†ç ï¼ˆPasswordï¼‰ï¼š</label>
            <input type="password" id="jasypt-password" placeholder="è¾“å…¥åŠ å¯†/è§£å¯†å¯†ç ">
        </div>
        <div class="input-group">
            <label>å¾…å¤„ç†æ–‡æœ¬ï¼š</label>
            <textarea id="jasypt-input" placeholder="è¾“å…¥è¦åŠ å¯†æˆ–è§£å¯†çš„æ–‡æœ¬..."></textarea>
        </div>
        <div class="input-group">
            <label>å¤„ç†ç»“æœï¼š</label>
            <textarea id="jasypt-output" readonly placeholder="ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>
        </div>
    </div>
</div>

<script>
    // å·¥å…·åˆ‡æ¢
    function showTool(toolName) {
        // éšè—æ‰€æœ‰å·¥ä½œåŒº
        document.querySelectorAll('.workspace').forEach(w => w.classList.remove('active'));
        document.querySelectorAll('.tool-card').forEach(c => c.classList.remove('active'));
        
        // æ˜¾ç¤ºé€‰ä¸­çš„å·¥ä½œåŒº
        const workspace = document.getElementById(toolName + '-workspace');
        if (workspace) {
            workspace.classList.add('active');
            event.currentTarget.classList.add('active');
        }
        
        // ç‰¹æ®Šåˆå§‹åŒ–
        if (toolName === 'timestamp') {
            updateCurrentTimestamp();
            setInterval(updateCurrentTimestamp, 1000);
        }
        if (toolName === 'color') {
            updateColorValues();
        }
    }
    
    // ========== JSON å·¥å…· ==========
    function showAlert(elementId, message, type) {
        const alertBox = document.getElementById(elementId);
        alertBox.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
        setTimeout(() => alertBox.innerHTML = '', 3000);
    }
    
    function formatJSON() {
        const input = document.getElementById('json-input').value.trim();
        if (!input) {
            showAlert('json-alert', 'è¯·è¾“å…¥JSONæ•°æ®', 'error');
            return;
        }
        
        try {
            const parsed = JSON.parse(input);
            document.getElementById('json-input').value = JSON.stringify(parsed, null, 4);
            showAlert('json-alert', 'æ ¼å¼åŒ–æˆåŠŸï¼', 'success');
        } catch (e) {
            showAlert('json-alert', 'JSONæ ¼å¼é”™è¯¯: ' + e.message, 'error');
        }
    }
    
    function compressJSON() {
        const input = document.getElementById('json-input').value.trim();
        if (!input) {
            showAlert('json-alert', 'è¯·è¾“å…¥JSONæ•°æ®', 'error');
            return;
        }
        
        try {
            const parsed = JSON.parse(input);
            document.getElementById('json-input').value = JSON.stringify(parsed);
            showAlert('json-alert', 'å‹ç¼©æˆåŠŸï¼', 'success');
        } catch (e) {
            showAlert('json-alert', 'JSONæ ¼å¼é”™è¯¯: ' + e.message, 'error');
        }
    }
    
    function validateJSON() {
        const input = document.getElementById('json-input').value.trim();
        if (!input) {
            showAlert('json-alert', 'è¯·è¾“å…¥JSONæ•°æ®', 'error');
            return;
        }
        
        try {
            JSON.parse(input);
            showAlert('json-alert', 'âœ… JSONæ ¼å¼æ­£ç¡®ï¼', 'success');
        } catch (e) {
            showAlert('json-alert', 'âŒ JSONæ ¼å¼é”™è¯¯: ' + e.message, 'error');
        }
    }
    
    function clearJSON() {
        document.getElementById('json-input').value = '';
        document.getElementById('json-alert').innerHTML = '';
    }
    
    // ========== Cron å·¥å…· ==========
    function applyCronPreset() {
        const preset = document.getElementById('cron-preset').value;
        if (!preset) return;
        
        const parts = preset.split(' ');
        document.getElementById('cron-minute').value = parts[0];
        document.getElementById('cron-hour').value = parts[1];
        document.getElementById('cron-day').value = parts[2];
        document.getElementById('cron-month').value = parts[3];
        document.getElementById('cron-week').value = parts[4];
        
        generateCron();
    }
    
    function generateCron() {
        const minute = document.getElementById('cron-minute').value || '*';
        const hour = document.getElementById('cron-hour').value || '*';
        const day = document.getElementById('cron-day').value || '*';
        const month = document.getElementById('cron-month').value || '*';
        const week = document.getElementById('cron-week').value || '*';
        
        const expression = `${minute} ${hour} ${day} ${month} ${week}`;
        
        document.getElementById('cron-expression').textContent = expression;
        document.getElementById('cron-description').textContent = describeCron(expression);
        document.getElementById('cron-result').style.display = 'block';
        
        // ç”Ÿæˆæ¥ä¸‹æ¥çš„æ‰§è¡Œæ—¶é—´ï¼ˆç®€åŒ–ç‰ˆï¼‰
        generateNextRuns(minute, hour, day, month, week);
    }
    
    function describeCron(expression) {
        const parts = expression.split(' ');
        const [min, hr, d, mon, wk] = parts;
        
        let desc = 'æ‰§è¡Œæ—¶é—´ï¼š';
        
        if (expression === '* * * * *') return 'æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡';
        if (expression === '0 * * * *') return 'æ¯å°æ—¶çš„ç¬¬0åˆ†é’Ÿæ‰§è¡Œ';
        if (expression === '0 0 * * *') return 'æ¯å¤©å‡Œæ™¨00:00æ‰§è¡Œ';
        if (expression === '0 0 * * 0') return 'æ¯å‘¨æ—¥å‡Œæ™¨00:00æ‰§è¡Œ';
        if (expression === '0 0 1 * *') return 'æ¯æœˆ1å·å‡Œæ™¨00:00æ‰§è¡Œ';
        if (expression === '0 9 * * 1-5') return 'æ¯å‘¨ä¸€åˆ°å‘¨äº”ä¸Šåˆ09:00æ‰§è¡Œ';
        
        // åˆ†é’Ÿ
        if (min === '*') desc += 'æ¯åˆ†é’Ÿ';
        else if (min.includes('/')) desc += `æ¯${min.split('/')[1]}åˆ†é’Ÿ`;
        else desc += `ç¬¬${min}åˆ†é’Ÿ`;
        
        // å°æ—¶
        if (hr === '*') desc += 'ï¼Œæ¯å°æ—¶';
        else if (hr.includes('/')) desc += `ï¼Œæ¯${hr.split('/')[1]}å°æ—¶`;
        else desc += `ï¼Œ${hr}ç‚¹`;
        
        // æ—¥æœŸ
        if (d !== '*') desc += `ï¼Œ${d}å·`;
        
        // æœˆä»½
        if (mon !== '*') desc += `ï¼Œ${mon}æœˆ`;
        
        // æ˜ŸæœŸ
        if (wk !== '*') {
            const weekNames = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
            if (wk.includes('-')) {
                const [start, end] = wk.split('-');
                desc += `ï¼Œ${weekNames[start]}åˆ°${weekNames[end]}`;
            } else {
                desc += `ï¼Œ${weekNames[wk]}`;
            }
        }
        
        return desc;
    }
    
    function generateNextRuns(min, hr, d, mon, wk) {
        const nextRuns = document.getElementById('next-runs');
        nextRuns.innerHTML = '';
        
        const now = new Date();
        let count = 0;
        let current = new Date(now);
        
        // ç®€åŒ–ç‰ˆï¼šä»…å±•ç¤ºåŸºæœ¬æƒ…å†µ
        if (min === '*' && hr === '*') {
            // æ¯åˆ†é’Ÿ
            for (let i = 0; i < 5; i++) {
                current = new Date(now.getTime() + (i + 1) * 60000);
                nextRuns.innerHTML += `<li>${formatDate(current)}</li>`;
            }
        } else if (min.startsWith('*/')) {
            // æ¯Nåˆ†é’Ÿ
            const interval = parseInt(min.split('/')[1]);
            for (let i = 0; i < 5; i++) {
                current = new Date(now.getTime() + (i + 1) * interval * 60000);
                nextRuns.innerHTML += `<li>${formatDate(current)}</li>`;
            }
        } else {
            // å›ºå®šæ—¶é—´
            for (let i = 1; i <= 5; i++) {
                current = new Date(now);
                current.setDate(now.getDate() + i);
                if (hr !== '*') current.setHours(parseInt(hr) || 0);
                if (min !== '*') current.setMinutes(parseInt(min) || 0);
                current.setSeconds(0);
                nextRuns.innerHTML += `<li>${formatDate(current)}</li>`;
            }
        }
    }
    
    function formatDate(date) {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        const hour = String(date.getHours()).padStart(2, '0');
        const minute = String(date.getMinutes()).padStart(2, '0');
        const second = String(date.getSeconds()).padStart(2, '0');
        
        const weekNames = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
        const weekDay = weekNames[date.getDay()];
        
        return `${year}-${month}-${day} ${hour}:${minute}:${second} ${weekDay}`;
    }
    
    // ========== Base64 å·¥å…· ==========
    function encodeBase64() {
        const input = document.getElementById('base64-input').value;
        if (!input) {
            showAlert('base64-alert', 'è¯·è¾“å…¥è¦ç¼–ç çš„æ–‡æœ¬', 'error');
            return;
        }
        
        try {
            const encoded = btoa(unescape(encodeURIComponent(input)));
            document.getElementById('base64-output').value = encoded;
            showAlert('base64-alert', 'ç¼–ç æˆåŠŸï¼', 'success');
        } catch (e) {
            showAlert('base64-alert', 'ç¼–ç å¤±è´¥: ' + e.message, 'error');
        }
    }
    
    function decodeBase64() {
        const input = document.getElementById('base64-input').value.trim();
        if (!input) {
            showAlert('base64-alert', 'è¯·è¾“å…¥è¦è§£ç çš„Base64å­—ç¬¦ä¸²', 'error');
            return;
        }
        
        try {
            const decoded = decodeURIComponent(escape(atob(input)));
            document.getElementById('base64-output').value = decoded;
            showAlert('base64-alert', 'è§£ç æˆåŠŸï¼', 'success');
        } catch (e) {
            showAlert('base64-alert', 'è§£ç å¤±è´¥: ' + e.message, 'error');
        }
    }
    
    function clearBase64() {
        document.getElementById('base64-input').value = '';
        document.getElementById('base64-output').value = '';
        document.getElementById('base64-alert').innerHTML = '';
    }
    
    // ========== æ—¶é—´æˆ³å·¥å…· ==========
    function updateCurrentTimestamp() {
        const now = Date.now();
        document.getElementById('current-timestamp').textContent = now + ' ms (' + Math.floor(now / 1000) + ' s)';
    }
    
    function timestampToDate() {
        const input = document.getElementById('ts-to-date-input').value.trim();
        if (!input) {
            document.getElementById('ts-to-date-result').textContent = 'è¯·è¾“å…¥æ—¶é—´æˆ³';
            return;
        }
        
        let timestamp = parseInt(input);
        // å¦‚æœæ˜¯ç§’çº§æ—¶é—´æˆ³ï¼Œè½¬æ¢ä¸ºæ¯«ç§’
        if (timestamp < 10000000000) {
            timestamp = timestamp * 1000;
        }
        
        const date = new Date(timestamp);
        document.getElementById('ts-to-date-result').innerHTML = `
            <strong>æœ¬åœ°æ—¶é—´ï¼š</strong><br>
            ${formatDate(date)}<br><br>
            <strong>ISO æ ¼å¼ï¼š</strong><br>
            ${date.toISOString()}<br><br>
            <strong>UTC æ—¶é—´ï¼š</strong><br>
            ${date.toUTCString()}
        `;
    }
    
    function dateToTimestamp() {
        const input = document.getElementById('date-to-ts-input').value;
        if (!input) {
            document.getElementById('date-to-ts-result').textContent = 'è¯·é€‰æ‹©æ—¥æœŸæ—¶é—´';
            return;
        }
        
        const date = new Date(input);
        const timestamp = date.getTime();
        
        document.getElementById('date-to-ts-result').innerHTML = `
            <strong>æ¯«ç§’æ—¶é—´æˆ³ï¼š</strong><br>
            ${timestamp} ms<br><br>
            <strong>ç§’æ—¶é—´æˆ³ï¼š</strong><br>
            ${Math.floor(timestamp / 1000)} s
        `;
    }
    
    // ========== URL å·¥å…· ==========
    function encodeURL() {
        const input = document.getElementById('url-input').value;
        if (!input) {
            showAlert('url-alert', 'è¯·è¾“å…¥è¦ç¼–ç çš„URL', 'error');
            return;
        }
        
        try {
            const encoded = encodeURIComponent(input);
            document.getElementById('url-output').value = encoded;
            showAlert('url-alert', 'ç¼–ç æˆåŠŸï¼', 'success');
        } catch (e) {
            showAlert('url-alert', 'ç¼–ç å¤±è´¥: ' + e.message, 'error');
        }
    }
    
    function decodeURL() {
        const input = document.getElementById('url-input').value.trim();
        if (!input) {
            showAlert('url-alert', 'è¯·è¾“å…¥è¦è§£ç çš„URL', 'error');
            return;
        }
        
        try {
            const decoded = decodeURIComponent(input);
            document.getElementById('url-output').value = decoded;
            showAlert('url-alert', 'è§£ç æˆåŠŸï¼', 'success');
        } catch (e) {
            showAlert('url-alert', 'è§£ç å¤±è´¥: ' + e.message, 'error');
        }
    }
    
    function clearURL() {
        document.getElementById('url-input').value = '';
        document.getElementById('url-output').value = '';
        document.getElementById('url-alert').innerHTML = '';
    }
    
    // ========== å“ˆå¸Œå·¥å…· ==========
    async function calculateHash() {
        const input = document.getElementById('hash-input').value;
        if (!input) {
            alert('è¯·è¾“å…¥è¦è®¡ç®—å“ˆå¸Œçš„æ–‡æœ¬');
            return;
        }
        
        // MD5 (ä½¿ç”¨ç®€åŒ–ç‰ˆå®ç°)
        document.getElementById('hash-md5').textContent = simpleMD5(input);
        
        // SHA-1 å’Œ SHA-256 (ä½¿ç”¨ Web Crypto API)
        const encoder = new TextEncoder();
        const data = encoder.encode(input);
        
        const sha1Hash = await crypto.subtle.digest('SHA-1', data);
        document.getElementById('hash-sha1').textContent = bufferToHex(sha1Hash);
        
        const sha256Hash = await crypto.subtle.digest('SHA-256', data);
        document.getElementById('hash-sha256').textContent = bufferToHex(sha256Hash);
    }
    
    function bufferToHex(buffer) {
        return Array.from(new Uint8Array(buffer))
            .map(b => b.toString(16).padStart(2, '0'))
            .join('');
    }
    
    function simpleMD5(str) {
        // ç®€åŒ–ç‰ˆMD5ï¼ˆç”¨äºæ¼”ç¤ºï¼Œå®é™…é¡¹ç›®å»ºè®®ä½¿ç”¨ä¸“ä¸šåº“ï¼‰
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
            const char = str.charCodeAt(i);
            hash = ((hash << 5) - hash) + char;
            hash = hash & hash;
        }
        return Math.abs(hash).toString(16).padStart(32, '0');
    }
    
    function clearHash() {
        document.getElementById('hash-input').value = '';
        document.getElementById('hash-md5').textContent = '';
        document.getElementById('hash-sha1').textContent = '';
        document.getElementById('hash-sha256').textContent = '';
    }
    
    // ========== UUID å·¥å…· ==========
    function generateUUID() {
        const uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
            const r = Math.random() * 16 | 0;
            const v = c === 'x' ? r : (r & 0x3 | 0x8);
            return v.toString(16);
        });
        document.getElementById('uuid-output').value = uuid;
    }
    
    function generateMultipleUUID() {
        const count = parseInt(document.getElementById('uuid-count').value) || 10;
        let uuids = [];
        
        for (let i = 0; i < Math.min(count, 100); i++) {
            const uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
            uuids.push(uuid);
        }
        
        document.getElementById('uuid-output').value = uuids.join('\n');
    }
    
    // ========== é¢œè‰²å·¥å…· ==========
    function updateColorValues() {
        const hex = document.getElementById('color-picker').value;
        document.getElementById('color-hex').value = hex;
        
        const rgb = hexToRgb(hex);
        document.getElementById('color-rgb').value = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
        
        const hsl = rgbToHsl(rgb.r, rgb.g, rgb.b);
        document.getElementById('color-hsl').value = `hsl(${Math.round(hsl.h)}, ${Math.round(hsl.s)}%, ${Math.round(hsl.l)}%)`;
        
        document.getElementById('color-preview').style.background = hex;
    }
    
    // ========== Jasypt åŠ è§£å¯†å·¥å…· ==========
    function showAlert(elementId, message, type) {
        const alertBox = document.getElementById(elementId);
        alertBox.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
        setTimeout(() => alertBox.innerHTML = '', 5000);
    }
    
    // åŠ å¯†å‡½æ•°
    async function encryptText() {
        const password = document.getElementById('jasypt-password').value.trim();
        const input = document.getElementById('jasypt-input').value;
        
        if (!password) {
            showAlert('jasypt-alert', 'è¯·è¾“å…¥å¯†ç ', 'error');
            return;
        }
        
        if (!input) {
            showAlert('jasypt-alert', 'è¯·è¾“å…¥è¦åŠ å¯†çš„æ–‡æœ¬', 'error');
            return;
        }
        
        try {
            const response = await fetch('/jasypt/encrypt', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    password: password,
                    text: input
                })
            });
            
            const result = await response.json();
            
            if (response.ok) {
                document.getElementById('jasypt-output').value = result.result;
                showAlert('jasypt-alert', 'åŠ å¯†æˆåŠŸï¼', 'success');
            } else {
                showAlert('jasypt-alert', 'åŠ å¯†å¤±è´¥: ' + result.error, 'error');
            }
        } catch (e) {
            showAlert('jasypt-alert', 'åŠ å¯†å¤±è´¥: ' + e.message, 'error');
        }
    }
    
    // è§£å¯†å‡½æ•°
    async function decryptText() {
        const password = document.getElementById('jasypt-password').value.trim();
        const input = document.getElementById('jasypt-input').value.trim();
        
        if (!password) {
            showAlert('jasypt-alert', 'è¯·è¾“å…¥å¯†ç ', 'error');
            return;
        }
        
        if (!input) {
            showAlert('jasypt-alert', 'è¯·è¾“å…¥è¦è§£å¯†çš„æ–‡æœ¬', 'error');
            return;
        }
        
        try {
            const response = await fetch('/jasypt/decrypt', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    password: password,
                    encrypted_text: input
                })
            });
            
            const result = await response.json();
            
            if (response.ok) {
                document.getElementById('jasypt-output').value = result.result;
                showAlert('jasypt-alert', 'è§£å¯†æˆåŠŸï¼', 'success');
            } else {
                showAlert('jasypt-alert', 'è§£å¯†å¤±è´¥: ' + result.error, 'error');
            }
        } catch (e) {
            showAlert('jasypt-alert', 'è§£å¯†å¤±è´¥: ' + e.message, 'error');
        }
    }
    
    function clearJasypt() {
        document.getElementById('jasypt-password').value = '';
        document.getElementById('jasypt-input').value = '';
        document.getElementById('jasypt-output').value = '';
        document.getElementById('jasypt-alert').innerHTML = '';
    }
    
    function convertFromHex() {
        const hex = document.getElementById('color-hex').value.trim();
        if (!/^#[0-9A-Fa-f]{6}$/.test(hex)) return;
        
        document.getElementById('color-picker').value = hex;
        updateColorValues();
    }
    
    function convertFromRGB() {
        const rgb = document.getElementById('color-rgb').value.trim();
        const match = rgb.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);
        if (!match) return;
        
        const r = parseInt(match[1]);
        const g = parseInt(match[2]);
        const b = parseInt(match[3]);
        
        const hex = rgbToHex(r, g, b);
        document.getElementById('color-picker').value = hex;
        document.getElementById('color-hex').value = hex;
        
        const hsl = rgbToHsl(r, g, b);
        document.getElementById('color-hsl').value = `hsl(${Math.round(hsl.h)}, ${Math.round(hsl.s)}%, ${Math.round(hsl.l)}%)`;
        
        document.getElementById('color-preview').style.background = hex;
    }
    
    function hexToRgb(hex) {
        const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        return result ? {
            r: parseInt(result[1], 16),
            g: parseInt(result[2], 16),
            b: parseInt(result[3], 16)
        } : null;
    }
    
    function rgbToHex(r, g, b) {
        return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
    }
    
    function rgbToHsl(r, g, b) {
        r /= 255;
        g /= 255;
        b /= 255;
        
        const max = Math.max(r, g, b);
        const min = Math.min(r, g, b);
        let h, s, l = (max + min) / 2;
        
        if (max === min) {
            h = s = 0;
        } else {
            const d = max - min;
            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
            
            switch (max) {
                case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                case g: h = (b - r) / d + 2; break;
                case b: h = (r - g) / d + 4; break;
            }
            h /= 6;
        }
        
        return {
            h: h * 360,
            s: s * 100,
            l: l * 100
        };
    }
    
    // åˆå§‹åŒ–ï¼šæ˜¾ç¤ºç¬¬ä¸€ä¸ªå·¥å…·
    window.onload = function() {
        showTool('json');
    };
</script>
{% endblock %}