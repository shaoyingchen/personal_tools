<!DOCTYPE html>
<html lang="{{ lang_html }}">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
    <meta name="color-scheme" content="light dark">
    <!-- Enhanced mobile optimization -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="{{ t('Prompt ç®¡ç†å™¨') }}">
    <!-- Mobile status bar colors for auto mode (follow OS) -->
    <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#0b0b0f" media="(prefers-color-scheme: dark)">
    <!-- PWA manifest -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <!-- Better favicon -->
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='favicon.svg') }}">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
    <!-- Preload critical resources -->
    <link rel="preload" href="{{ url_for('static', filename='css/style.css') }}" as="style">
    <link rel="preload" href="{{ url_for('static', filename='js/main.js') }}" as="script">
    <title>{% block title %}{{ t('Prompt ç®¡ç†å™¨') }}{% endblock %}</title>
    <script>
        // Apply saved manual theme ASAP to avoid flash; otherwise follow system
        (function () {
            try {
                var saved = localStorage.getItem('theme'); // 'light' | 'dark' | null(è‡ªåŠ¨)
                if (saved === 'light' || saved === 'dark') {
                    document.documentElement.setAttribute('data-theme', saved);
                    window.__THEME__ = saved;
                } else {
                    // è‡ªåŠ¨æ¨¡å¼ï¼šä¸è®¾ç½® data-themeï¼Œç”± CSS + prefers-color-scheme æ§åˆ¶
                    document.documentElement.removeAttribute('data-theme');
                    window.__THEME__ = 'auto';
                }
            } catch (e) {
                // Fallback to auto if localStorage unavailable
                document.documentElement.removeAttribute('data-theme');
                window.__THEME__ = 'auto';
            }
        })();
    </script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v=20251109-1550"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        .brand {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .brand .btn.ghost {
            padding: 8px 12px;
        }
        
        /* æ–°å¢ç°ä»£åŒ–å¯¼èˆªæ ·å¼ */
        .nav-links {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            background: var(--card);
            border-radius: var(--radius-xl);
            padding: var(--spacing-xs);
            border: 1px solid var(--border);
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-lg);
            color: var(--fg);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s ease;
            position: relative;
            z-index: 1;
        }
        
        .nav-link:hover {
            background: color-mix(in srgb, var(--primary) 5%, transparent);
            transform: translateY(-1px);
        }
        
        .nav-link.active {
            background: var(--primary);
            color: var(--text-on-primary);
        }
        
        .nav-link i {
            font-size: var(--font-size-base);
        }
        
        .nav-text {
            font-size: var(--font-size-sm);
        }
        
        @media (max-width: 768px) {
            .nav-links {
                gap: var(--spacing-xs);
                padding: var(--spacing-xs);
            }
            
            .nav-link {
                padding: var(--spacing-xs) var(--spacing-sm);
            }
            
            .nav-text {
                font-size: var(--font-size-xs);
            }
        }
    </style>
</head>
<body>
<header class="topbar">
    <nav class="nav-links">
        <a href="{{ url_for('index') }}" class="nav-link" aria-label="{{ t('æç¤ºè¯ç®¡ç†') }}">
            <i class="fas fa-folder-open"></i>
            <span class="nav-text">{{ t('æç¤ºè¯ç®¡ç†') }}</span>
        </a>
        <a href="{{ url_for('toolbox') }}" class="nav-link" aria-label="å·¥å…·ç®±">
            <i class="fas fa-toolbox"></i>
            <span class="nav-text">å·¥å…·ç®±</span>
        </a>
        <a href="https://v.flomoapp.com/mine" class="nav-link" aria-label="ä¸ªäººéšç¬”" target="_blank">
            <i class="fas fa-book"></i>
            <span class="nav-text">ä¸ªäººéšç¬”</span>
        </a>
    </nav>
    <nav class="nav">
        <a href="{{ url_for('ai_configs') }}" class="btn ghost" title="AI é…ç½®ç®¡ç†" aria-label="AI é…ç½®ç®¡ç†">ğŸ¤– <span
                class="nav-text">{{ t('AIé…ç½®') }}</span></a>
        <a href="{{ url_for('settings') }}" class="btn ghost" aria-label="{{ t('è®¾ç½®') }}">{{ t('è®¾ç½®') }}</a>
        <button id="themeToggle" class="btn ghost" title="{{ t('åˆ‡æ¢ä¸»é¢˜') }}" aria-label="{{ t('åˆ‡æ¢ä¸»é¢˜') }}">ğŸŒ“
        </button>
    </nav>
</header>

{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <div class="flash-wrap">
            {% for category, message in messages %}
                <div class="flash {{ category }}">{{ t(message) }}</div>
            {% endfor %}
        </div>
    {% endif %}
{% endwith %}

<main class="container">
    {% block content %}{% endblock %}
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>window.APP_LANG = '{{ lang }}';</script>
<script src="{{ url_for('static', filename='js/main.js') }}?v=20251108-4"></script>
</body>
</html>
